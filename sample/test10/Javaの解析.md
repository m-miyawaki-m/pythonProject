**Java の解析において「ロジック > DAO」 の流れを明確にするために必要な検討事項と実装ポイント**を表形式で整理しました。

---

### **Java 解析: ロジック > DAO の流れを解析するために必要な事項**

| **No** | **検討項目**                     | **必要な解析内容・実装要件**                                               | **成果物・出力**                       |
| ------ | -------------------------------- | -------------------------------------------------------------------------- | -------------------------------------- |
| **1**  | **クラスの依存関係の解析**       | - Logic クラスから呼び出される DAO クラスを特定する。                      | クラス名、依存先クラス名               |
|        |                                  | - `import`ステートメントやフィールド宣言を解析する。                       |                                        |
| **2**  | **メソッド呼び出し解析**         | - Logic クラスのメソッド内で DAO メソッドの呼び出しを特定。                | 呼び出し元メソッド、呼び出し先メソッド |
|        |                                  | - `new`によるインスタンス生成、`@Autowired`解析。                          |                                        |
| **3**  | **CRUD 種別の識別**              | - DAO メソッド内で CRUD 操作（SELECT, INSERT, UPDATE, DELETE）を識別する。 | CRUD 種別（CREATE/READ/UPDATE/DELETE） |
|        |                                  | - DAO メソッドの中で MyBatis XML の ID を解析しマッピングする。            |                                        |
| **4**  | **MyBatis Namespace の関連付け** | - DAO メソッドと MyBatis XML の Namespace・ID を紐付ける。                 | MyBatis Namespace, ID                  |
|        |                                  | - DAO クラスのメソッド名と XML の SQL タグを照合する。                     |                                        |
| **5**  | **パラメータ情報の取得**         | - DAO メソッドに渡されるパラメータ情報を取得する。                         | パラメータ名・型                       |
| **6**  | **複数階層の呼び出し解析**       | - Logic → Service → DAO など複数階層の呼び出しを解析。                     | 呼び出し階層情報                       |
| **7**  | **例外処理・条件分岐の考慮**     | - 例外処理（try-catch）や条件分岐（if-else）内の呼び出しも特定する。       | 完全な呼び出しパス                     |
| **8**  | **未使用 DAO メソッドの検出**    | - Logic クラスで使用されていない DAO メソッドを検出する。                  | 未使用メソッドリスト                   |
| **9**  | **解析対象のスコープ管理**       | - 解析対象を特定のディレクトリやパッケージに限定する。                     | 対象クラス・ファイル一覧               |
| **10** | **結果の CSV 出力**              | - 解析結果をファイル単位で CSV 形式で出力する。                            | CSV 出力（詳細は以下参照）             |

---

### **成果物としての CSV フォーマット**

Java の解析結果を表現する CSV は、以下の項目を含めることで「ロジック > DAO」の流れを可視化できます。

| **カラム名**       | **説明**                                     |
| ------------------ | -------------------------------------------- |
| クラス名           | Logic クラス名、Service クラス名             |
| ファイル名         | Java ファイル名                              |
| 呼び出し元メソッド | Logic クラス内のメソッド名                   |
| 呼び出し先クラス   | DAO クラス名                                 |
| 呼び出し先メソッド | DAO メソッド名                               |
| CRUD 種別          | CRUD 操作の種類（CREATE/READ/UPDATE/DELETE） |
| MyBatis Namespace  | MyBatis XML ファイルの Namespace 名          |
| MyBatis ID         | MyBatis XML 内の SQL タグ ID                 |
| パラメータ名       | DAO メソッドに渡されるパラメータ名           |
| 呼び出し階層       | 呼び出しの階層（例: Logic > Service > DAO）  |

---

## **補足: 実装ポイントと注意事項**

1. **依存関係の抽出**：

   - `@Autowired`や`new`キーワードによる DAO の依存関係を解析する。

2. **メソッド呼び出しのトラッキング**：

   - Java メソッド内のメソッド呼び出しを追跡し、呼び出し元と呼び出し先の対応を解析。

3. **CRUD 種別の識別**：

   - MyBatis XML 解析結果と連携し、DAO メソッドが呼び出す SQL タグ（`select`, `insert`など）をマッピング。

4. **出力の単位**：

   - クラス・ファイル単位で CSV 出力することで、Git 差分との連携が容易になる。

5. **例外処理・条件分岐への対応**：
   - 呼び出しが例外ブロックや条件分岐内にある場合でも正確に特定する。

---

## **まとめ**

上記の解析タスクを実装することで、**ロジック（Logic） → DAO → MyBatis XML** の流れを正確に可視化し、CRUD 操作の全体像を把握できます。

- **解析結果はファイル単位で出力**し、CI/CD パイプラインと連携することで差分解析・完全解析を効率化。
- **未使用メソッドの検出**や**条件分岐の考慮**など、実用的な解析機能も組み込むとさらに精度が向上します。
