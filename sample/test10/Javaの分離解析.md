その通りです。**Java 解析も「ロジック解析」と「DAO 解析」を分けて実装**することで、責務が明確になり、複雑な依存関係の解析が効率的かつ正確に行えます。

---

## **Java 解析: ロジック解析と DAO 解析の分離**

### **1. ロジック解析フェーズ**

| **No** | **検討項目**               | **必要な情報・内容**                                                     | **実装ポイント**                         | **成果物**                           |
| ------ | -------------------------- | ------------------------------------------------------------------------ | ---------------------------------------- | ------------------------------------ |
| **1**  | **クラスの解析**           | - Logic クラス（Service や Controller 含む）の特定。                     | Java ファイルをクラス単位で解析する。    | Logic クラス名、ファイル名           |
| **2**  | **メソッド解析**           | - Logic クラス内のメソッドを抽出する。                                   | javalang でメソッド宣言を解析する。      | メソッド名リスト                     |
| **3**  | **依存関係の解析**         | - `@Autowired`や`new`キーワードから DAO クラスを依存関係として特定する。 | フィールド宣言やコンストラクタを解析。   | 依存関係マッピング                   |
| **4**  | **メソッド呼び出しの特定** | - Logic メソッド内で呼び出される DAO メソッドの検出。                    | メソッド内の呼び出しをトラッキングする。 | 呼び出し元・呼び出し先メソッド対応表 |
| **5**  | **結果の中間データ出力**   | - クラス単位・メソッド単位の情報を整理。                                 | 中間データを CSV/JSON 形式で出力する。   | Logic 解析結果（CSV/JSON）           |

---

### **2. DAO 解析フェーズ**

| **No** | **検討項目**               | **必要な情報・内容**                                              | **実装ポイント**                             | **成果物**                    |
| ------ | -------------------------- | ----------------------------------------------------------------- | -------------------------------------------- | ----------------------------- |
| **1**  | **DAO クラスの特定**       | - DAO クラスの識別（Logic 解析結果に基づく）。                    | DAO インターフェースおよび実装クラスを解析。 | DAO クラス名、ファイル名      |
| **2**  | **DAO メソッドの解析**     | - DAO クラス内のメソッド定義を特定する。                          | javalang を用いてメソッド定義を解析。        | DAO メソッド名リスト          |
| **3**  | **MyBatis 呼び出しの検出** | - DAO メソッドから MyBatis XML の Namespace/ID の呼び出しを特定。 | メソッド内の`namespace.method`文字列を検出。 | Namespace、ID、呼び出し情報   |
| **4**  | **パラメータ情報の取得**   | - DAO メソッドの引数（パラメータ）を解析する。                    | メソッドシグネチャを解析し型・引数名を取得。 | パラメータ情報                |
| **5**  | **CRUD 種別の関連付け**    | - MyBatis XML 解析結果と連携して CRUD 種別を特定。                | XML 側の CRUD 情報をマッピング。             | CRUD 種別（READ/CREATE など） |
| **6**  | **結果の中間データ出力**   | - DAO メソッドと MyBatis の関連情報を整理。                       | 中間データを CSV/JSON 形式で出力する。       | DAO 解析結果（CSV/JSON）      |

---

## **ロジック解析と DAO 解析の連携ポイント**

ロジック解析と DAO 解析は、**DAO クラスを中心に連携**する形になります。

1. **ロジック解析結果**：

   - Logic クラスがどの DAO クラスのメソッドを呼び出しているかを特定。
   - 依存関係や呼び出しメソッド情報を記録。

2. **DAO 解析結果**：

   - DAO クラスのメソッドが MyBatis XML のどの Namespace/ID を呼び出しているかを特定。
   - パラメータ情報や CRUD 種別を記録。

3. **統合フェーズ**：
   - **Logic 解析結果**と**DAO 解析結果**を DAO クラス・メソッド名をキーに結合。
   - 結合した結果を MyBatis XML 解析結果と関連付け、最終的な CRUD 図を作成。

---

## **データ出力フォーマットの統合**

ロジック解析と DAO 解析で出力した中間データを以下の項目で統合し、最終 CRUD 図にまとめます。

| **カラム名**      | **説明**                                    |
| ----------------- | ------------------------------------------- |
| Logic クラス名    | Logic/Service クラス名                      |
| Logic メソッド名  | Logic クラス内の呼び出し元メソッド名        |
| DAO クラス名      | 依存する DAO クラス名                       |
| DAO メソッド名    | 呼び出される DAO メソッド名                 |
| MyBatis Namespace | DAO メソッドが参照する MyBatis の Namespace |
| MyBatis ID        | MyBatis XML 内の SQL タグ ID                |
| CRUD 種別         | CREATE / READ / UPDATE / DELETE             |
| パラメータ        | DAO メソッドで使用されるパラメータ名        |
| テーブル名        | SQL 文から抽出したテーブル名                |
| カラム名          | SQL 文から抽出したカラム名                  |
| 条件式            | WHERE 句や JOIN 句の条件式                  |
| XML ファイル名    | MyBatis XML のファイル名                    |

---

## **まとめ: 分離のメリット**

1. **責務の明確化**：

   - ロジック解析 → Logic クラスの依存関係やメソッド呼び出しの特定に集中。
   - DAO 解析 → DAO クラスのメソッド解析および MyBatis XML との関連付けに集中。

2. **保守性の向上**：

   - ロジックや DAO に変更があった場合でも、該当部分の解析だけを実行すればよい。

3. **統合の効率化**：
   - 中間データ（CSV/JSON）として出力し、最終的にマージする形を取ることで解析結果を柔軟に統合できる。

---

これにより、**ロジック > DAO > MyBatis XML**の流れが明確になり、変更時の影響範囲の特定や CRUD 図の作成が効率的になります。
