概要設計を作成する際、以下の構成で進めると効果的です。このプロジェクトに基づき、以下の内容を提案します。

---

# **概要設計**

## **目的**

MyBatis の XML ファイルから SQL 文を解析し、CRUD 図作成や影響範囲分析に必要なデータを CSV 形式で出力する仕組みを提供する。

## **全体構成**

### **1. 入力**

- MyBatis XML ファイル群
  - 対象タグ: `<select>`, `<insert>`, `<update>`, `<delete>`, `<sql>`, `<include>`

### **2. 処理内容**

- XML ファイルの解析
  - SQL 文のパース
  - テーブル名、カラム名、条件式、条件出典の抽出
  - `<sql>`タグや`<include>`タグの展開と参照解決
- データ整理
  - タグ・ID ごとにデータを集計し、テーブルごとに分割
- 出力
  - 整理済みデータを JSON および CSV 形式で保存

### **3. 出力**

- CSV 形式のデータ
  - 各テーブル・カラムの使用状況および条件式、出典情報を含む
- JSON 形式のデータ
  - タグごとに集計された詳細情報

---

## **システム構成**

### **1. 主なモジュール**

#### **1.1 XML 処理モジュール**

- `read_xml_files`: 指定ディレクトリから XML ファイルを収集
- `parse_mybatis_xml`: MyBatis XML ファイルを解析し、必要なデータを抽出

#### **1.2 SQL 解析モジュール**

- `parse_sql`: SQL 文を解析してテーブル名、カラム名、条件式を抽出
- `expand_sql_includes`: `<sql>`タグと`<include>`タグを展開

#### **1.3 出力モジュール**

- `save_to_csv`: データを CSV 形式で出力
- `save_to_json`: データを JSON 形式で出力

---

## **データフロー**

1. **XML 読み込み**
   - `read_xml_files`を使用して入力ディレクトリ内の XML ファイルを取得
2. **XML 解析**
   - 各ファイルを`parse_mybatis_xml`で解析し、SQL 文を展開・解析
3. **データ集計**
   - タグごとにデータを整理し、テーブル・カラム単位で記録
4. **ファイル出力**
   - 整理済みデータを`save_to_csv`と`save_to_json`で保存

---

## **制約事項**

1. **SQL 文の複雑性**
   - サブクエリ、ネストされた`<include>`タグに対応
2. **タグ展開順序**
   - 再帰的なタグ展開を順序通りに実施し、正確なデータ抽出を保証
